#!/bin/bash

if [ $SOURCE_BRANCH = "master" ]; then
  VERSION="dev"
else
  VERSION="$SOURCE_BRANCH"
fi

docker tag $DOCKER_REPO:$VERSION-base saxon:base

docker build -t $DOCKER_REPO:$VERSION -f Dockerfile-full .
docker push $DOCKER_REPO:$VERSION

docker build -t $DOCKER_REPO:$VERSION-graal -f Dockerfile-graal .
docker push $DOCKER_REPO:$VERSION-graal

if [ $SOURCE_BRANCH != "master" ]; then
  docker tag $DOCKER_REPO:$VERSION-base $DOCKER_REPO:latest-base
  docker push $DOCKER_REPO:latest-base

  docker tag $DOCKER_REPO:$VERSION-base $DOCKER_REPO:base
  docker push $DOCKER_REPO:base

  docker tag $DOCKER_REPO:$VERSION $DOCKER_REPO:latest
  docker push $DOCKER_REPO:latest

  docker tag $DOCKER_REPO:$VERSION-graal $DOCKER_REPO:latest-graal
  docker push $DOCKER_REPO:latest-graal

  docker tag $DOCKER_REPO:$VERSION-graal $DOCKER_REPO:graal
  docker push $DOCKER_REPO:graal
fi
